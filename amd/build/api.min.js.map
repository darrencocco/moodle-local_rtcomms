{"version":3,"file":"api.min.js","sources":["../src/api.js"],"sourcesContent":["/**\n * Real time events\n *\n * @module     tool_realtime/events\n * @copyright  2020 Marina Glancy\n */\ndefine(['core/pubsub', 'tool_realtime/events'], function(PubSub, RealTimeEvents) {\n\n    document.listofchannels = [];\n\n    return {\n        setImplementation: function(plugin) {\n            var totalchannels;\n            document.delegatedplugin = plugin;\n            // in here check list to subscribe once plugin has been set\n            if(!document.listofchannels) {\n                return;\n            }\n            totalchannels = document.listofchannels.length;\n\n            if (totalchannels > 0) {\n                for (var i = 0; i < totalchannels; i++) {\n                    var channeltosub = document.listofchannels.shift();\n                    document.delegatedplugin.subscribe( channeltosub.context,\n                                                        channeltosub.component,\n                                                        channeltosub.area,\n                                                        channeltosub.itemid,\n                                                        channeltosub.fromid,\n                                                        channeltosub.fromtimestamp);\n                }\n            }\n        },\n        subscribe: function(context, component, area, itemid, callback = null, fromId= -1, fromTimestamp = -1) {\n            if(fromId == -1 && fromTimestamp == -1) {\n                fromTimestamp = (new Date).getTime();\n            }\n\n            // Check that plugin implementation has been set.\n            if (this.getPlugin()) {\n                //  conditional for plugin being set\n                this.getPlugin().subscribe(context, component, area, itemid, fromId, fromTimestamp);\n            } else {\n                // Channel object to store in list\n                var channel = {\n                    context: context,\n                    component: component,\n                    area: area,\n                    itemid: itemid,\n                    fromid: fromId,\n                    fromtimestamp: fromTimestamp\n                };\n                // push channel to list\n                document.listofchannels.push(channel);\n            }\n            if (callback instanceof Function) {\n                PubSub.subscribe(this.channelName(context, component, area, itemid), callback);\n            }\n        },\n        getPlugin: function() {\n            return document.delegatedplugin;\n        },\n\n        publish: function(message) {\n            PubSub.publish(this.channelName(message.context.id, message.component, message.area, message.itemid), message);\n        },\n\n        connectionFailure: function() {\n            PubSub.publish(RealTimeEvents.CONNECTION_LOST, {});\n        },\n\n        channelName: function (context, component, area, itemid) {\n            return RealTimeEvents.EVENT + '/' + context + '/' + component + '/' + area + '/' + itemid;\n        }\n    };\n});"],"names":["define","PubSub","RealTimeEvents","document","listofchannels","setImplementation","plugin","totalchannels","delegatedplugin","length","i","channeltosub","shift","subscribe","context","component","area","itemid","fromid","fromtimestamp","callback","fromId","fromTimestamp","Date","getTime","this","getPlugin","channel","push","Function","channelName","publish","message","id","connectionFailure","CONNECTION_LOST","EVENT"],"mappings":"AAMAA,2BAAO,CAAC,cAAe,yBAAyB,SAASC,OAAQC,uBAE7DC,SAASC,eAAiB,GAEnB,CACHC,kBAAmB,SAASC,YACpBC,iBACJJ,SAASK,gBAAkBF,OAEvBH,SAASC,iBAGbG,cAAgBJ,SAASC,eAAeK,QAEpB,MACX,IAAIC,EAAI,EAAGA,EAAIH,cAAeG,IAAK,KAChCC,aAAeR,SAASC,eAAeQ,QAC3CT,SAASK,gBAAgBK,UAAWF,aAAaG,QACbH,aAAaI,UACbJ,aAAaK,KACbL,aAAaM,OACbN,aAAaO,OACbP,aAAaQ,iBAI7DN,UAAW,SAASC,QAASC,UAAWC,KAAMC,YAAQG,gEAAW,KAAMC,+DAAS,EAAGC,sEAAiB,MAClF,GAAXD,SAAkC,GAAlBC,gBACfA,eAAiB,IAAIC,MAAMC,WAI3BC,KAAKC,iBAEAA,YAAYb,UAAUC,QAASC,UAAWC,KAAMC,OAAQI,OAAQC,mBAClE,KAECK,QAAU,CACVb,QAASA,QACTC,UAAWA,UACXC,KAAMA,KACNC,OAAQA,OACRC,OAAQG,OACRF,cAAeG,eAGnBnB,SAASC,eAAewB,KAAKD,SAE7BP,oBAAoBS,UACpB5B,OAAOY,UAAUY,KAAKK,YAAYhB,QAASC,UAAWC,KAAMC,QAASG,WAG7EM,UAAW,kBACAvB,SAASK,iBAGpBuB,QAAS,SAASC,SACd/B,OAAO8B,QAAQN,KAAKK,YAAYE,QAAQlB,QAAQmB,GAAID,QAAQjB,UAAWiB,QAAQhB,KAAMgB,QAAQf,QAASe,UAG1GE,kBAAmB,WACfjC,OAAO8B,QAAQ7B,eAAeiC,gBAAiB,KAGnDL,YAAa,SAAUhB,QAASC,UAAWC,KAAMC,eACtCf,eAAekC,MAAQ,IAAMtB,QAAU,IAAMC,UAAY,IAAMC,KAAO,IAAMC"}