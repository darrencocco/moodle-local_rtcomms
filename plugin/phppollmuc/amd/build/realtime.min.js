define ("realtimeplugin_phppollmuc/realtime",["core/pubsub","tool_realtime/events","tool_realtime/api"],function(a,b,c){var d,e=[],f=[],g,h=new XMLHttpRequest,j,k=0,l=function(){var c=new Date,d=c.getTime();f.push(d);f=f.slice(-10);if(10<=f.length&&5e3>d-f[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},m=function(){if(!l()){return}h.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(200===this.status){k=0;try{j=JSON.parse(this.responseText)}catch(a){setTimeout(m,d.timeout);return}if(!j.success||1!==j.success){k++;var c=Math.min(Math.trunc(Math.pow(Math.E,k)*d.timeout),3e5);setTimeout(m,c);return}var e=j.events;for(var f in e){a.publish(b.EVENT,e[f]);d.fromid=e[f].index}setTimeout(m,d.timeout)}else{setTimeout(m,d.timeout)}}};var c=g+"?userid="+encodeURIComponent(d.userid)+"&token="+encodeURIComponent(d.token)+"&fromid="+encodeURIComponent(d.fromid);if(0>=e.length){return}for(var f="",n="",o="",p="",q="",r=0;r<e.length;r++){if(r==e.length-1){f+=e[r].context;n+=e[r].component;o+=e[r].area;p+=e[r].itemid;q+=e[r].fromtimestamp}else{f+=e[r].context+"-";n+=e[r].component+"-";o+=e[r].area+"-";p+=e[r].itemid+"-";q+=e[r].fromtimestamp+"-"}}var s="&channel="+f+":"+n+":"+o+":"+p+":"+q;c+=s;h.open("GET",c,!0);h.send()},n={init:function init(a,b,e,f){if(!(d&&d.userid)){d={userid:a,token:b,timeout:f}}g=e;c.setImplementation(n)},subscribe:function subscribe(a,b,c,f,g,h){d.fromid=g;var i={context:a,component:b,area:c,itemid:f,fromtimestamp:h};if(i){e.push(i)}setTimeout(m,d.timeout)}};return n});
//# sourceMappingURL=realtime.min.js.map
