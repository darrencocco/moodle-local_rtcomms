define ("realtimeplugin_phppollmuc/realtime",["core/pubsub","tool_realtime/events","tool_realtime/api"],function(a,b,c){var d,e=[],f=[],g,h=new XMLHttpRequest,j,k,l=function(){var c=new Date,d=c.getTime();f.push(d);f=f.slice(-10);if(10<=f.length&&5e3>d-f[0]){a.publish(b.CONNECTION_LOST,{});return!1}return!0};h.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE){if(200===this.status){try{j=JSON.parse(this.responseText)}catch(a){setTimeout(m,d.timeout);return}var c=j.events;for(var e in c){a.publish(b.EVENT,c[e]);d.fromid=c[e].id}}o();n()}};var m=function(){if(!l()||1>e.length){return}var a=g+"?userid="+encodeURIComponent(d.userid)+"&token="+encodeURIComponent(d.token)+"&fromid="+encodeURIComponent(d.fromid),b=e.reduce(function(a,b){return a+b.context+":"+b.component+":"+b.area+":"+b.itemId+":"+b.fromTimestamp+";"},"");h.open("GET",a+"&channel="+b,!0);h.send()},n=function(){if(null===k){k=setTimeout(m,d.timeout)}},o=function(){k=null},p={init:function init(a,b,e,f){if(!(d&&d.userid)){d={userid:a,token:b,timeout:f}}g=e;c.setImplementation(p)},subscribe:function subscribe(a,b,c,f,g,h){d.fromid=g;var i={context:a,component:b,area:c,itemId:f,fromTimestamp:h};if(i){e.push(i)}n()}};return p});
//# sourceMappingURL=realtime.min.js.map
