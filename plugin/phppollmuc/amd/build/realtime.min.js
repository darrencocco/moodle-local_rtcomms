define ("realtimeplugin_phppollmuc/realtime",["core/pubsub","tool_realtime/events","tool_realtime/api"],function(a,b,c){var d,e=[],f=[],g,h=new XMLHttpRequest,j,k=0,l=function(){var c=new Date,d=c.getTime();f.push(d);f=f.slice(-10);if(10<=f.length&&5e3>d-f[0]){a.publish(b.CONNECTION_LOST);return!1}return!0},m=function(){return Math.min(Math.trunc(Math.pow(Math.E,k)*d.timeout),3e5)},n=function(){if(!l()){return}h.onreadystatechange=function(){if(4===this.readyState){if(200===this.status){try{j=JSON.parse(this.responseText)}catch(a){setTimeout(n,d.timeout);return}if(!j.success||1!==j.success){k++;setTimeout(n,m());return}k=0;var c=j.events;for(var e in c){a.publish(b.EVENT,c[e]);d.fromid=c[e].index}setTimeout(n,d.timeout)}else{setTimeout(n,m())}}};var c=g+"?userid="+encodeURIComponent(d.userid)+"&token="+encodeURIComponent(d.token)+"&fromid="+encodeURIComponent(d.fromid);if(0>=e.length){return}for(var f="",o="",p="",q="",r="",s=0;s<e.length;s++){if(s==e.length-1){f+=e[s].context;o+=e[s].component;p+=e[s].area;q+=e[s].itemid;r+=e[s].fromtimestamp}else{f+=e[s].context+"-";o+=e[s].component+"-";p+=e[s].area+"-";q+=e[s].itemid+"-";r+=e[s].fromtimestamp+"-"}}var t="&channel="+f+":"+o+":"+p+":"+q+":"+r;c+=t;h.open("GET",c,!0);h.send()},o={init:function init(a,b,e,f){if(!(d&&d.userid)){d={userid:a,token:b,timeout:f}}g=e;c.setImplementation(o)},subscribe:function subscribe(a,b,c,f,g,h){d.fromid=g;var i={context:a,component:b,area:c,itemid:f,fromtimestamp:h};if(i){e.push(i)}setTimeout(n,d.timeout)}};return o});
//# sourceMappingURL=realtime.min.js.map
